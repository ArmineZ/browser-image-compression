!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).imageCompression=e()}(this,function(){"use strict";function t(t){return new Promise(function(e,n){var i=new FileReader;i.readAsDataURL(t),i.onload=function(){e(i.result)},i.onerror=n})}function e(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();return new Promise(function(i){for(var r,o=t.split(","),a=o[0].match(/:(.*?);/)[1],h=atob(o[1]),u=h.length,c=new Uint8Array(u);u--;)c[u]=h.charCodeAt(u);try{r=new File([c],e,{type:a})}catch(t){(r=new Blob([c],{type:a})).name=e,r.lastModified=n}i(r)})}function n(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=n,i.src=t})}function i(t,e){var n=document.createElement("canvas"),i=n.getContext("2d");return Number.isInteger(e)&&(t.width>e||t.height>e)?t.width>t.height?(n.width=e,n.height=t.height/t.width*e):(n.width=t.width/t.height*e,n.height=e):(n.width=t.width,n.height=t.height),i.drawImage(t,0,0,n.width,n.height),n}function r(r){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY,a=arguments.length>2?arguments[2]:void 0;return new Promise(function(h,u){var c,f,d,l,s,g;return r instanceof Blob||r instanceof File?/^image/.test(r.type)?(c=5,f=1024*o*1024,t(r).then(function(t){try{return n(t).then(function(t){try{return l=i(d=t,a),s=1,e(l.toDataURL(r.type,s),r.name,r.lastModified).then(function(t){try{var n=function(){return h(g)};if(g=t,"image/png"===r.type){var i,o=function t(){return c--&&g.size>f?(l.width*=.9,l.height*=.9,l.getContext("2d").drawImage(d,0,0,l.width,l.height),e(l.toDataURL(r.type,s),r.name,r.lastModified).then(function(e){try{return g=e,t}catch(t){return u(t)}},u)):[1]},a=function(){return n.call(this)};return(i=function(t){for(;t;){if(t.then)return void t.then(i,u);try{if(t.pop){if(t.length)return t.pop()?a.call(this):t;t=o}else t=t.call(this)}catch(t){return u(t)}}}.bind(this))(o)}var m,w=function t(){return c--&&g.size>f?(l.width*=.9,l.height*=.9,l.getContext("2d").drawImage(d,0,0,l.width,l.height),s*=.9,e(l.toDataURL(r.type,s),r.name,r.lastModified).then(function(e){try{return g=e,t}catch(t){return u(t)}},u)):[1]},p=function(){return n.call(this)};return(m=function(t){for(;t;){if(t.then)return void t.then(m,u);try{if(t.pop){if(t.length)return t.pop()?p.call(this):t;t=w}else t=t.call(this)}catch(t){return u(t)}}}.bind(this))(w)}catch(t){return u(t)}}.bind(this),u)}catch(t){return u(t)}}.bind(this),u)}catch(t){return u(t)}}.bind(this),u)):u(new Error("The file given is not an image")):u(new Error("The file given is not an instance of Blob or File"))})}return r.drawImageInCanvas=i,r.getDataUrlFromFile=t,r.getFilefromDataUrl=e,r.loadImage=n,r});
//# sourceMappingURL=browser-image-compression.js.map
