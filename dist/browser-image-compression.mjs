/**
 * Browser Image Compression
 * v2.0.2
 * by Donald <donaldcwl@gmail.com>
 * https://github.com/Donaldcwl/browser-image-compression
 */

function _mergeNamespaces(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}async function copyExifWithoutOrientation(e,t){const r=await getApp1Segment(e);return new Blob([t.slice(0,2),r,t.slice(2)],{type:"image/jpeg"})}const getApp1Segment=e=>new Promise(((t,r)=>{const i=new FileReader;i.addEventListener("load",(({target:{result:e}})=>{const i=new DataView(e);let o=0;if(65496!==i.getUint16(o))return r("not a valid JPEG");for(o+=2;;){const a=i.getUint16(o);if(65498===a)break;const s=i.getUint16(o+2);if(65505===a&&1165519206===i.getUint32(o+4)){const a=o+10;let f;switch(i.getUint16(a)){case 18761:f=!0;break;case 19789:f=!1;break;default:return r("TIFF header contains invalid endian")}if(42!==i.getUint16(a+2,f))return r("TIFF header contains invalid version");const l=i.getUint32(a+4,f),c=a+l+2+12*i.getUint16(a+l,f);for(let e=a+l+2;e<c;e+=12){if(274==i.getUint16(e,f)){if(3!==i.getUint16(e+2,f))return r("Orientation data type is invalid");if(1!==i.getUint32(e+4,f))return r("Orientation data count is invalid");i.setUint16(e+8,1,f);break}}return t(e.slice(o,o+2+s))}o+=2+s}return t(new Blob)})),i.readAsArrayBuffer(e)}));function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var e,t={exports:{}};var r=function requireUZIP(){return e||(e=1,function(){var e,r,UZIP={};t.exports=UZIP,UZIP.parse=function(e,t){for(var r=UZIP.bin.readUshort,i=UZIP.bin.readUint,o=0,a={},s=new Uint8Array(e),f=s.length-4;101010256!=i(s,f);)f--;o=f;o+=4;var l=r(s,o+=4);r(s,o+=2);var c=i(s,o+=2),u=i(s,o+=4);o+=4,o=u;for(var d=0;d<l;d++){i(s,o),o+=4,o+=4,o+=4,i(s,o+=4);c=i(s,o+=4);var h=i(s,o+=4),g=r(s,o+=4),p=r(s,o+2),m=r(s,o+4);o+=6;var w=i(s,o+=8);o+=4,o+=g+p+m,UZIP._readLocal(s,w,a,c,h,t)}return a},UZIP._readLocal=function(e,t,r,i,o,a){var s=UZIP.bin.readUshort,f=UZIP.bin.readUint;f(e,t),s(e,t+=4),s(e,t+=2);var l=s(e,t+=2);f(e,t+=2),f(e,t+=4),t+=4;var c=s(e,t+=8),u=s(e,t+=2);t+=2;var d=UZIP.bin.readUTF8(e,t,c);if(t+=c,t+=u,a)r[d]={size:o,csize:i};else{var h=new Uint8Array(e.buffer,t);if(0==l)r[d]=new Uint8Array(h.buffer.slice(t,t+i));else{if(8!=l)throw"unknown compression method: "+l;var g=new Uint8Array(o);UZIP.inflateRaw(h,g),r[d]=g}}},UZIP.inflateRaw=function(e,t){return UZIP.F.inflate(e,t)},UZIP.inflate=function(e,t){return e[0],e[1],UZIP.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},UZIP.deflate=function(e,t){null==t&&(t={level:6});var r=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[r]=120,i[r+1]=156,r+=2,r=UZIP.F.deflateRaw(e,i,r,t.level);var o=UZIP.adler(e,0,e.length);return i[r+0]=o>>>24&255,i[r+1]=o>>>16&255,i[r+2]=o>>>8&255,i[r+3]=o>>>0&255,new Uint8Array(i.buffer,0,r+4)},UZIP.deflateRaw=function(e,t){null==t&&(t={level:6});var r=new Uint8Array(50+Math.floor(1.1*e.length)),i=UZIP.F.deflateRaw(e,r,i,t.level);return new Uint8Array(r.buffer,0,i)},UZIP.encode=function(e,t){null==t&&(t=!1);var r=0,i=UZIP.bin.writeUint,o=UZIP.bin.writeUshort,a={};for(var s in e){var f=!UZIP._noNeed(s)&&!t,l=e[s],c=UZIP.crc.crc(l,0,l.length);a[s]={cpr:f,usize:l.length,crc:c,file:f?UZIP.deflateRaw(l):l}}for(var s in a)r+=a[s].file.length+30+46+2*UZIP.bin.sizeUTF8(s);r+=22;var u=new Uint8Array(r),d=0,h=[];for(var s in a){var g=a[s];h.push(d),d=UZIP._writeHeader(u,d,s,g,0)}var p=0,m=d;for(var s in a){g=a[s];h.push(d),d=UZIP._writeHeader(u,d,s,g,1,h[p++])}var w=d-m;return i(u,d,101010256),d+=4,o(u,d+=4,p),o(u,d+=2,p),i(u,d+=2,w),i(u,d+=4,m),d+=4,d+=2,u.buffer},UZIP._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return-1!="png,jpg,jpeg,zip".indexOf(t)},UZIP._writeHeader=function(e,t,r,i,o,a){var s=UZIP.bin.writeUint,f=UZIP.bin.writeUshort,l=i.file;return s(e,t,0==o?67324752:33639248),t+=4,1==o&&(t+=2),f(e,t,20),f(e,t+=2,0),f(e,t+=2,i.cpr?8:0),s(e,t+=2,0),s(e,t+=4,i.crc),s(e,t+=4,l.length),s(e,t+=4,i.usize),f(e,t+=4,UZIP.bin.sizeUTF8(r)),f(e,t+=2,0),t+=2,1==o&&(t+=2,t+=2,s(e,t+=6,a),t+=4),t+=UZIP.bin.writeUTF8(e,t,r),0==o&&(e.set(l,t),t+=l.length),t},UZIP.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,i=0;i<8;i++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update:function(e,t,r,i){for(var o=0;o<i;o++)e=UZIP.crc.table[255&(e^t[r+o])]^e>>>8;return e},crc:function(e,t,r){return 4294967295^UZIP.crc.update(4294967295,e,t,r)}},UZIP.adler=function(e,t,r){for(var i=1,o=0,a=t,s=t+r;a<s;){for(var f=Math.min(a+5552,s);a<f;)o+=i+=e[a++];i%=65521,o%=65521}return o<<16|i},UZIP.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,r){e[t]=255&r,e[t+1]=r>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,r){e[t]=255&r,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255},readASCII:function(e,t,r){for(var i="",o=0;o<r;o++)i+=String.fromCharCode(e[t+o]);return i},writeASCII:function(e,t,r){for(var i=0;i<r.length;i++)e[t+i]=r.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,r){for(var i,o="",a=0;a<r;a++)o+="%"+UZIP.bin.pad(e[t+a].toString(16));try{i=decodeURIComponent(o)}catch(i){return UZIP.bin.readASCII(e,t,r)}return i},writeUTF8:function(e,t,r){for(var i=r.length,o=0,a=0;a<i;a++){var s=r.charCodeAt(a);if(4294967168&s)if(4294965248&s)if(4294901760&s){if(4292870144&s)throw"e";e[t+o]=240|s>>18,e[t+o+1]=128|s>>12&63,e[t+o+2]=128|s>>6&63,e[t+o+3]=128|63&s,o+=4}else e[t+o]=224|s>>12,e[t+o+1]=128|s>>6&63,e[t+o+2]=128|63&s,o+=3;else e[t+o]=192|s>>6,e[t+o+1]=128|63&s,o+=2;else e[t+o]=s,o++}return o},sizeUTF8:function(e){for(var t=e.length,r=0,i=0;i<t;i++){var o=e.charCodeAt(i);if(4294967168&o)if(4294965248&o)if(4294901760&o){if(4292870144&o)throw"e";r+=4}else r+=3;else r+=2;else r++}return r}},UZIP.F={},UZIP.F.deflateRaw=function(e,t,r,i){var o=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],a=UZIP.F.U,s=UZIP.F._goodIndex;UZIP.F._hash;var f=UZIP.F._putsE,l=0,c=r<<3,u=0,d=e.length;if(0==i){for(;l<d;){f(t,c,l+(_=Math.min(65535,d-l))==d?1:0),c=UZIP.F._copyExact(e,l,_,t,c+8),l+=_}return c>>>3}var h=a.lits,g=a.strt,p=a.prev,m=0,w=0,A=0,v=0,b=0,y=0;for(d>2&&(g[y=UZIP.F._hash(e,0)]=0),l=0;l<d;l++){if(b=y,l+1<d-2){y=UZIP.F._hash(e,l+1);var F=l+1&32767;p[F]=g[y],g[y]=F}if(u<=l){(m>14e3||w>26697)&&d-l>100&&(u<l&&(h[m]=l-u,m+=2,u=l),c=UZIP.F._writeBlock(l==d-1||u==d?1:0,h,m,v,e,A,l-A,t,c),m=w=v=0,A=l);var U=0;l<d-2&&(U=UZIP.F._bestMatch(e,l,p,b,Math.min(o[2],d-l),o[3]));var _=U>>>16,C=65535&U;if(0!=U){C=65535&U;var E=s(_=U>>>16,a.of0);a.lhst[257+E]++;var I=s(C,a.df0);a.dhst[I]++,v+=a.exb[E]+a.dxb[I],h[m]=_<<23|l-u,h[m+1]=C<<16|E<<8|I,m+=2,u=l+_}else a.lhst[e[l]]++;w++}}for(A==l&&0!=e.length||(u<l&&(h[m]=l-u,m+=2,u=l),c=UZIP.F._writeBlock(1,h,m,v,e,A,l-A,t,c),m=0,w=0,m=w=v=0,A=l);7&c;)c++;return c>>>3},UZIP.F._bestMatch=function(e,t,r,i,o,a){var s=32767&t,f=r[s],l=s-f+32768&32767;if(f==s||i!=UZIP.F._hash(e,t-l))return 0;for(var c=0,u=0,d=Math.min(32767,t);l<=d&&0!=--a&&f!=s;){if(0==c||e[t+c]==e[t+c-l]){var h=UZIP.F._howLong(e,t,l);if(h>c){if(u=l,(c=h)>=o)break;l+2<h&&(h=l+2);for(var g=0,p=0;p<h-2;p++){var m=t-l+p+32768&32767,w=m-r[m]+32768&32767;w>g&&(g=w,f=m)}}}l+=(s=f)-(f=r[s])+32768&32767}return c<<16|u},UZIP.F._howLong=function(e,t,r){if(e[t]!=e[t-r]||e[t+1]!=e[t+1-r]||e[t+2]!=e[t+2-r])return 0;var i=t,o=Math.min(e.length,t+258);for(t+=3;t<o&&e[t]==e[t-r];)t++;return t-i},UZIP.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},UZIP.saved=0,UZIP.F._writeBlock=function(e,t,r,i,o,a,s,f,l){var c,u,d,h,g,p,m,w,A,v=UZIP.F.U,b=UZIP.F._putsF,y=UZIP.F._putsE;v.lhst[256]++,u=(c=UZIP.F.getTrees())[0],d=c[1],h=c[2],g=c[3],p=c[4],m=c[5],w=c[6],A=c[7];var F=32+(l+3&7?8-(l+3&7):0)+(s<<3),U=i+UZIP.F.contSize(v.fltree,v.lhst)+UZIP.F.contSize(v.fdtree,v.dhst),_=i+UZIP.F.contSize(v.ltree,v.lhst)+UZIP.F.contSize(v.dtree,v.dhst);_+=14+3*m+UZIP.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var C=0;C<286;C++)v.lhst[C]=0;for(C=0;C<30;C++)v.dhst[C]=0;for(C=0;C<19;C++)v.ihst[C]=0;var E=F<U&&F<_?0:U<_?1:2;if(b(f,l,e),b(f,l+1,E),l+=3,0==E){for(;7&l;)l++;l=UZIP.F._copyExact(o,a,s,f,l)}else{var I,B;if(1==E&&(I=v.fltree,B=v.fdtree),2==E){UZIP.F.makeCodes(v.ltree,u),UZIP.F.revCodes(v.ltree,u),UZIP.F.makeCodes(v.dtree,d),UZIP.F.revCodes(v.dtree,d),UZIP.F.makeCodes(v.itree,h),UZIP.F.revCodes(v.itree,h),I=v.ltree,B=v.dtree,y(f,l,g-257),y(f,l+=5,p-1),y(f,l+=5,m-4),l+=4;for(var M=0;M<m;M++)y(f,l+3*M,v.itree[1+(v.ordr[M]<<1)]);l+=3*m,l=UZIP.F._codeTiny(w,v.itree,f,l),l=UZIP.F._codeTiny(A,v.itree,f,l)}for(var x=a,O=0;O<r;O+=2){for(var S=t[O],T=S>>>23,R=x+(8388607&S);x<R;)l=UZIP.F._writeLit(o[x++],I,f,l);if(0!=T){var P=t[O+1],Q=P>>16,k=P>>8&255,H=255&P;y(f,l=UZIP.F._writeLit(257+k,I,f,l),T-v.of0[k]),l+=v.exb[k],b(f,l=UZIP.F._writeLit(H,B,f,l),Q-v.df0[H]),l+=v.dxb[H],x+=T}}l=UZIP.F._writeLit(256,I,f,l)}return l},UZIP.F._copyExact=function(e,t,r,i,o){var a=o>>>3;return i[a]=r,i[a+1]=r>>>8,i[a+2]=255-i[a],i[a+3]=255-i[a+1],a+=4,i.set(new Uint8Array(e.buffer,t,r),a),o+(r+4<<3)},UZIP.F.getTrees=function(){for(var e=UZIP.F.U,t=UZIP.F._hufTree(e.lhst,e.ltree,15),r=UZIP.F._hufTree(e.dhst,e.dtree,15),i=[],o=UZIP.F._lenCodes(e.ltree,i),a=[],s=UZIP.F._lenCodes(e.dtree,a),f=0;f<i.length;f+=2)e.ihst[i[f]]++;for(f=0;f<a.length;f+=2)e.ihst[a[f]]++;for(var l=UZIP.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,r,l,o,s,c,i,a]},UZIP.F.getSecond=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(e[r+1]);return t},UZIP.F.nonZero=function(e){for(var t="",r=0;r<e.length;r+=2)0!=e[r+1]&&(t+=(r>>1)+",");return t},UZIP.F.contSize=function(e,t){for(var r=0,i=0;i<t.length;i++)r+=t[i]*e[1+(i<<1)];return r},UZIP.F._codeTiny=function(e,t,r,i){for(var o=0;o<e.length;o+=2){var a=e[o],s=e[o+1];i=UZIP.F._writeLit(a,t,r,i);var f=16==a?2:17==a?3:7;a>15&&(UZIP.F._putsE(r,i,s,f),i+=f)}return i},UZIP.F._lenCodes=function(e,t){for(var r=e.length;2!=r&&0==e[r-1];)r-=2;for(var i=0;i<r;i+=2){var o=e[i+1],a=i+3<r?e[i+3]:-1,s=i+5<r?e[i+5]:-1,f=0==i?-1:e[i-1];if(0==o&&a==o&&s==o){for(var l=i+5;l+2<r&&e[l+2]==o;)l+=2;(c=Math.min(l+1-i>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),i+=2*c-2}else if(o==f&&a==o&&s==o){for(l=i+5;l+2<r&&e[l+2]==o;)l+=2;var c=Math.min(l+1-i>>>1,6);t.push(16,c-3),i+=2*c-2}else t.push(o,0)}return r>>>1},UZIP.F._hufTree=function(e,t,r){var i=[],o=e.length,a=t.length,s=0;for(s=0;s<a;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<o;s++)0!=e[s]&&i.push({lit:s,f:e[s]});var f=i.length,l=i.slice(0);if(0==f)return 0;if(1==f){var c=i[0].lit;l=0==c?1:0;return t[1+(c<<1)]=1,t[1+(l<<1)]=1,1}i.sort((function(e,t){return e.f-t.f}));var u=i[0],d=i[1],h=0,g=1,p=2;for(i[0]={lit:-1,f:u.f+d.f,l:u,r:d,d:0};g!=f-1;)u=h!=g&&(p==f||i[h].f<i[p].f)?i[h++]:i[p++],d=h!=g&&(p==f||i[h].f<i[p].f)?i[h++]:i[p++],i[g++]={lit:-1,f:u.f+d.f,l:u,r:d};var m=UZIP.F.setDepth(i[g-1],0);for(m>r&&(UZIP.F.restrictDepth(l,r,m),m=r),s=0;s<f;s++)t[1+(l[s].lit<<1)]=l[s].d;return m},UZIP.F.setDepth=function(e,t){return-1!=e.lit?(e.d=t,t):Math.max(UZIP.F.setDepth(e.l,t+1),UZIP.F.setDepth(e.r,t+1))},UZIP.F.restrictDepth=function(e,t,r){var i=0,o=1<<r-t,a=0;for(e.sort((function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d})),i=0;i<e.length&&e[i].d>t;i++){var s=e[i].d;e[i].d=t,a+=o-(1<<r-s)}for(a>>>=r-t;a>0;){(s=e[i].d)<t?(e[i].d++,a-=1<<t-s-1):i++}for(;i>=0;i--)e[i].d==t&&a<0&&(e[i].d--,a++);0!=a&&console.log("debt left")},UZIP.F._goodIndex=function(e,t){var r=0;return t[16|r]<=e&&(r|=16),t[8|r]<=e&&(r|=8),t[4|r]<=e&&(r|=4),t[2|r]<=e&&(r|=2),t[1|r]<=e&&(r|=1),r},UZIP.F._writeLit=function(e,t,r,i){return UZIP.F._putsF(r,i,t[e<<1]),i+t[1+(e<<1)]},UZIP.F.inflate=function(e,t){var r=Uint8Array;if(3==e[0]&&0==e[1])return t||new r(0);var i=UZIP.F,o=i._bitsF,a=i._bitsE,s=i._decodeTiny,f=i.makeCodes,l=i.codes2map,c=i._get17,u=i.U,d=null==t;d&&(t=new r(e.length>>>2<<3));for(var h,g,p=0,m=0,w=0,A=0,v=0,b=0,y=0,F=0,U=0;0==p;)if(p=o(e,U,1),m=o(e,U+1,2),U+=3,0!=m){if(d&&(t=UZIP.F._check(t,F+(1<<17))),1==m&&(h=u.flmap,g=u.fdmap,b=511,y=31),2==m){w=a(e,U,5)+257,A=a(e,U+5,5)+1,v=a(e,U+10,4)+4,U+=14;for(var _=0;_<38;_+=2)u.itree[_]=0,u.itree[_+1]=0;var C=1;for(_=0;_<v;_++){var E=a(e,U+3*_,3);u.itree[1+(u.ordr[_]<<1)]=E,E>C&&(C=E)}U+=3*v,f(u.itree,C),l(u.itree,C,u.imap),h=u.lmap,g=u.dmap,U=s(u.imap,(1<<C)-1,w+A,e,U,u.ttree);var I=i._copyOut(u.ttree,0,w,u.ltree);b=(1<<I)-1;var B=i._copyOut(u.ttree,w,A,u.dtree);y=(1<<B)-1,f(u.ltree,I),l(u.ltree,I,h),f(u.dtree,B),l(u.dtree,B,g)}for(;;){var M=h[c(e,U)&b];U+=15&M;var x=M>>>4;if(x>>>8==0)t[F++]=x;else{if(256==x)break;var O=F+x-254;if(x>264){var S=u.ldef[x-257];O=F+(S>>>3)+a(e,U,7&S),U+=7&S}var T=g[c(e,U)&y];U+=15&T;var R=T>>>4,P=u.ddef[R],Q=(P>>>4)+o(e,U,15&P);for(U+=15&P,d&&(t=UZIP.F._check(t,F+(1<<17)));F<O;)t[F]=t[F++-Q],t[F]=t[F++-Q],t[F]=t[F++-Q],t[F]=t[F++-Q];F=O}}}else{7&U&&(U+=8-(7&U));var k=4+(U>>>3),H=e[k-4]|e[k-3]<<8;d&&(t=UZIP.F._check(t,F+H)),t.set(new r(e.buffer,e.byteOffset+k,H),F),U=k+H<<3,F+=H}return t.length==F?t:t.slice(0,F)},UZIP.F._check=function(e,t){var r=e.length;if(t<=r)return e;var i=new Uint8Array(Math.max(r<<1,t));return i.set(e,0),i},UZIP.F._decodeTiny=function(e,t,r,i,o,a){for(var s=UZIP.F._bitsE,f=UZIP.F._get17,l=0;l<r;){var c=e[f(i,o)&t];o+=15&c;var u=c>>>4;if(u<=15)a[l]=u,l++;else{var d=0,h=0;16==u?(h=3+s(i,o,2),o+=2,d=a[l-1]):17==u?(h=3+s(i,o,3),o+=3):18==u&&(h=11+s(i,o,7),o+=7);for(var g=l+h;l<g;)a[l]=d,l++}}return o},UZIP.F._copyOut=function(e,t,r,i){for(var o=0,a=0,s=i.length>>>1;a<r;){var f=e[a+t];i[a<<1]=0,i[1+(a<<1)]=f,f>o&&(o=f),a++}for(;a<s;)i[a<<1]=0,i[1+(a<<1)]=0,a++;return o},UZIP.F.makeCodes=function(e,t){for(var r,i,o,a,s=UZIP.F.U,f=e.length,l=s.bl_count,c=0;c<=t;c++)l[c]=0;for(c=1;c<f;c+=2)l[e[c]]++;var u=s.next_code;for(r=0,l[0]=0,i=1;i<=t;i++)r=r+l[i-1]<<1,u[i]=r;for(o=0;o<f;o+=2)0!=(a=e[o+1])&&(e[o]=u[a],u[a]++)},UZIP.F.codes2map=function(e,t,r){for(var i=e.length,o=UZIP.F.U.rev15,a=0;a<i;a+=2)if(0!=e[a+1])for(var s=a>>1,f=e[a+1],l=s<<4|f,c=t-f,u=e[a]<<c,d=u+(1<<c);u!=d;){r[o[u]>>>15-t]=l,u++}},UZIP.F.revCodes=function(e,t){for(var r=UZIP.F.U.rev15,i=15-t,o=0;o<e.length;o+=2){var a=e[o]<<t-e[o+1];e[o]=r[a]>>>i}},UZIP.F._putsE=function(e,t,r){r<<=7&t;var i=t>>>3;e[i]|=r,e[i+1]|=r>>>8},UZIP.F._putsF=function(e,t,r){r<<=7&t;var i=t>>>3;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},UZIP.F._bitsE=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1},UZIP.F._bitsF=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1},UZIP.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},UZIP.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},UZIP.F.U=(e=Uint16Array,r=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new e(65536),prev:new e(32768)}),function(){for(var e=UZIP.F.U,t=0;t<32768;t++){var r=t;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,e.rev15[t]=(r>>>16|r<<16)>>>17}function pushV(e,t,r){for(;0!=t--;)e.push(0,r)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];pushV(e.fltree,144,8),pushV(e.fltree,112,9),pushV(e.fltree,24,7),pushV(e.fltree,8,8),UZIP.F.makeCodes(e.fltree,9),UZIP.F.codes2map(e.fltree,9,e.flmap),UZIP.F.revCodes(e.fltree,9),pushV(e.fdtree,32,5),UZIP.F.makeCodes(e.fdtree,5),UZIP.F.codes2map(e.fdtree,5,e.fdmap),UZIP.F.revCodes(e.fdtree,5),pushV(e.itree,19,0),pushV(e.ltree,286,0),pushV(e.dtree,30,0),pushV(e.ttree,320,0)}()}()),t.exports}(),i=_mergeNamespaces({__proto__:null,default:getDefaultExportFromCjs(r)},[r]);const UPNG=function(){var e={nextZero(e,t){for(;0!=e[t];)t++;return t},readUshort:(e,t)=>e[t]<<8|e[t+1],writeUshort(e,t,r){e[t]=r>>8&255,e[t+1]=255&r},readUint:(e,t)=>16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3]),writeUint(e,t,r){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},readASCII(e,t,r){let i="";for(let o=0;o<r;o++)i+=String.fromCharCode(e[t+o]);return i},writeASCII(e,t,r){for(let i=0;i<r.length;i++)e[t+i]=r.charCodeAt(i)},readBytes(e,t,r){const i=[];for(let o=0;o<r;o++)i.push(e[t+o]);return i},pad:e=>e.length<2?`0${e}`:e,readUTF8(t,r,i){let o,a="";for(let o=0;o<i;o++)a+=`%${e.pad(t[r+o].toString(16))}`;try{o=decodeURIComponent(a)}catch(o){return e.readASCII(t,r,i)}return o}};function decodeImage(t,r,i,o){const a=r*i,s=_getBPP(o),f=Math.ceil(r*s/8),l=new Uint8Array(4*a),c=new Uint32Array(l.buffer),{ctype:u}=o,{depth:d}=o,h=e.readUshort;if(6==u){const e=a<<2;if(8==d)for(var g=0;g<e;g+=4)l[g]=t[g],l[g+1]=t[g+1],l[g+2]=t[g+2],l[g+3]=t[g+3];if(16==d)for(g=0;g<e;g++)l[g]=t[g<<1]}else if(2==u){const e=o.tabs.tRNS;if(null==e){if(8==d)for(g=0;g<a;g++){var p=3*g;c[g]=255<<24|t[p+2]<<16|t[p+1]<<8|t[p]}if(16==d)for(g=0;g<a;g++){p=6*g;c[g]=255<<24|t[p+4]<<16|t[p+2]<<8|t[p]}}else{var m=e[0];const r=e[1],i=e[2];if(8==d)for(g=0;g<a;g++){var w=g<<2;p=3*g;c[g]=255<<24|t[p+2]<<16|t[p+1]<<8|t[p],t[p]==m&&t[p+1]==r&&t[p+2]==i&&(l[w+3]=0)}if(16==d)for(g=0;g<a;g++){w=g<<2,p=6*g;c[g]=255<<24|t[p+4]<<16|t[p+2]<<8|t[p],h(t,p)==m&&h(t,p+2)==r&&h(t,p+4)==i&&(l[w+3]=0)}}}else if(3==u){const e=o.tabs.PLTE,s=o.tabs.tRNS,c=s?s.length:0;if(1==d)for(var A=0;A<i;A++){var v=A*f,b=A*r;for(g=0;g<r;g++){w=b+g<<2;var y=3*(F=t[v+(g>>3)]>>7-(7&g)&1);l[w]=e[y],l[w+1]=e[y+1],l[w+2]=e[y+2],l[w+3]=F<c?s[F]:255}}if(2==d)for(A=0;A<i;A++)for(v=A*f,b=A*r,g=0;g<r;g++){w=b+g<<2,y=3*(F=t[v+(g>>2)]>>6-((3&g)<<1)&3);l[w]=e[y],l[w+1]=e[y+1],l[w+2]=e[y+2],l[w+3]=F<c?s[F]:255}if(4==d)for(A=0;A<i;A++)for(v=A*f,b=A*r,g=0;g<r;g++){w=b+g<<2,y=3*(F=t[v+(g>>1)]>>4-((1&g)<<2)&15);l[w]=e[y],l[w+1]=e[y+1],l[w+2]=e[y+2],l[w+3]=F<c?s[F]:255}if(8==d)for(g=0;g<a;g++){var F;w=g<<2,y=3*(F=t[g]);l[w]=e[y],l[w+1]=e[y+1],l[w+2]=e[y+2],l[w+3]=F<c?s[F]:255}}else if(4==u){if(8==d)for(g=0;g<a;g++){w=g<<2;var U=t[_=g<<1];l[w]=U,l[w+1]=U,l[w+2]=U,l[w+3]=t[_+1]}if(16==d)for(g=0;g<a;g++){var _;w=g<<2,U=t[_=g<<2];l[w]=U,l[w+1]=U,l[w+2]=U,l[w+3]=t[_+2]}}else if(0==u)for(m=o.tabs.tRNS?o.tabs.tRNS:-1,A=0;A<i;A++){const e=A*f,i=A*r;if(1==d)for(var C=0;C<r;C++){var E=(U=255*(t[e+(C>>>3)]>>>7-(7&C)&1))==255*m?0:255;c[i+C]=E<<24|U<<16|U<<8|U}else if(2==d)for(C=0;C<r;C++){E=(U=85*(t[e+(C>>>2)]>>>6-((3&C)<<1)&3))==85*m?0:255;c[i+C]=E<<24|U<<16|U<<8|U}else if(4==d)for(C=0;C<r;C++){E=(U=17*(t[e+(C>>>1)]>>>4-((1&C)<<2)&15))==17*m?0:255;c[i+C]=E<<24|U<<16|U<<8|U}else if(8==d)for(C=0;C<r;C++){E=(U=t[e+C])==m?0:255;c[i+C]=E<<24|U<<16|U<<8|U}else if(16==d)for(C=0;C<r;C++){U=t[e+(C<<1)],E=h(t,e+(C<<1))==m?0:255;c[i+C]=E<<24|U<<16|U<<8|U}}return l}function _decompress(e,r,i,o){const a=_getBPP(e),s=Math.ceil(i*a/8),f=new Uint8Array((s+1+e.interlace)*o);return r=e.tabs.CgBI?t(r,f):_inflate(r,f),0==e.interlace?r=_filterZero(r,e,0,i,o):1==e.interlace&&(r=function _readInterlace(e,t){const r=t.width,i=t.height,o=_getBPP(t),a=o>>3,s=Math.ceil(r*o/8),f=new Uint8Array(i*s);let l=0;const c=[0,0,4,0,2,0,1],u=[0,4,0,2,0,1,0],d=[8,8,8,4,4,2,2],h=[8,8,4,4,2,2,1];let g=0;for(;g<7;){const m=d[g],w=h[g];let A=0,v=0,b=c[g];for(;b<i;)b+=m,v++;let y=u[g];for(;y<r;)y+=w,A++;const F=Math.ceil(A*o/8);_filterZero(e,t,l,A,v);let U=0,_=c[g];for(;_<i;){let t=u[g],i=l+U*F<<3;for(;t<r;){var p;if(1==o)p=(p=e[i>>3])>>7-(7&i)&1,f[_*s+(t>>3)]|=p<<7-(7&t);if(2==o)p=(p=e[i>>3])>>6-(7&i)&3,f[_*s+(t>>2)]|=p<<6-((3&t)<<1);if(4==o)p=(p=e[i>>3])>>4-(7&i)&15,f[_*s+(t>>1)]|=p<<4-((1&t)<<2);if(o>=8){const r=_*s+t*a;for(let t=0;t<a;t++)f[r+t]=e[(i>>3)+t]}i+=o,t+=w}U++,_+=m}A*v!=0&&(l+=v*(1+F)),g+=1}return f}(r,e)),r}function _inflate(e,r){return t(new Uint8Array(e.buffer,2,e.length-6),r)}var t=function(){const e={H:{}};return e.H.N=function(t,r){const i=Uint8Array;let o,a,s=0,f=0,l=0,c=0,u=0,d=0,h=0,g=0,p=0;if(3==t[0]&&0==t[1])return r||new i(0);const m=e.H,w=m.b,A=m.e,v=m.R,b=m.n,y=m.A,F=m.Z,U=m.m,_=null==r;for(_&&(r=new i(t.length>>>2<<5));0==s;)if(s=w(t,p,1),f=w(t,p+1,2),p+=3,0!=f){if(_&&(r=e.H.W(r,g+(1<<17))),1==f&&(o=U.J,a=U.h,d=511,h=31),2==f){l=A(t,p,5)+257,c=A(t,p+5,5)+1,u=A(t,p+10,4)+4,p+=14;let e=1;for(var C=0;C<38;C+=2)U.Q[C]=0,U.Q[C+1]=0;for(C=0;C<u;C++){const r=A(t,p+3*C,3);U.Q[1+(U.X[C]<<1)]=r,r>e&&(e=r)}p+=3*u,b(U.Q,e),y(U.Q,e,U.u),o=U.w,a=U.d,p=v(U.u,(1<<e)-1,l+c,t,p,U.v);const r=m.V(U.v,0,l,U.C);d=(1<<r)-1;const i=m.V(U.v,l,c,U.D);h=(1<<i)-1,b(U.C,r),y(U.C,r,o),b(U.D,i),y(U.D,i,a)}for(;;){const e=o[F(t,p)&d];p+=15&e;const i=e>>>4;if(i>>>8==0)r[g++]=i;else{if(256==i)break;{let e=g+i-254;if(i>264){const r=U.q[i-257];e=g+(r>>>3)+A(t,p,7&r),p+=7&r}const o=a[F(t,p)&h];p+=15&o;const s=o>>>4,f=U.c[s],l=(f>>>4)+w(t,p,15&f);for(p+=15&f;g<e;)r[g]=r[g++-l],r[g]=r[g++-l],r[g]=r[g++-l],r[g]=r[g++-l];g=e}}}}else{7&p&&(p+=8-(7&p));const o=4+(p>>>3),a=t[o-4]|t[o-3]<<8;_&&(r=e.H.W(r,g+a)),r.set(new i(t.buffer,t.byteOffset+o,a),g),p=o+a<<3,g+=a}return r.length==g?r:r.slice(0,g)},e.H.W=function(e,t){const r=e.length;if(t<=r)return e;const i=new Uint8Array(r<<1);return i.set(e,0),i},e.H.R=function(t,r,i,o,a,s){const f=e.H.e,l=e.H.Z;let c=0;for(;c<i;){const e=t[l(o,a)&r];a+=15&e;const i=e>>>4;if(i<=15)s[c]=i,c++;else{let e=0,t=0;16==i?(t=3+f(o,a,2),a+=2,e=s[c-1]):17==i?(t=3+f(o,a,3),a+=3):18==i&&(t=11+f(o,a,7),a+=7);const r=c+t;for(;c<r;)s[c]=e,c++}}return a},e.H.V=function(e,t,r,i){let o=0,a=0;const s=i.length>>>1;for(;a<r;){const r=e[a+t];i[a<<1]=0,i[1+(a<<1)]=r,r>o&&(o=r),a++}for(;a<s;)i[a<<1]=0,i[1+(a<<1)]=0,a++;return o},e.H.n=function(t,r){const i=e.H.m,o=t.length;let a,s,f;let l;const c=i.j;for(var u=0;u<=r;u++)c[u]=0;for(u=1;u<o;u+=2)c[t[u]]++;const d=i.K;for(a=0,c[0]=0,s=1;s<=r;s++)a=a+c[s-1]<<1,d[s]=a;for(f=0;f<o;f+=2)l=t[f+1],0!=l&&(t[f]=d[l],d[l]++)},e.H.A=function(t,r,i){const o=t.length,a=e.H.m.r;for(let e=0;e<o;e+=2)if(0!=t[e+1]){const o=e>>1,s=t[e+1],f=o<<4|s,l=r-s;let c=t[e]<<l;const u=c+(1<<l);for(;c!=u;){i[a[c]>>>15-r]=f,c++}}},e.H.l=function(t,r){const i=e.H.m.r,o=15-r;for(let e=0;e<t.length;e+=2){const a=t[e]<<r-t[e+1];t[e]=i[a]>>>o}},e.H.M=function(e,t,r){r<<=7&t;const i=t>>>3;e[i]|=r,e[i+1]|=r>>>8},e.H.I=function(e,t,r){r<<=7&t;const i=t>>>3;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},e.H.e=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1},e.H.b=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1},e.H.Z=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},e.H.i=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},e.H.m=function(){const e=Uint16Array,t=Uint32Array;return{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new t(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new t(286),Y:new t(30),a:new t(19),t:new t(15e3),k:new e(65536),g:new e(32768)}}(),function(){const t=e.H.m;for(var r=0;r<32768;r++){let e=r;e=(2863311530&e)>>>1|(1431655765&e)<<1,e=(3435973836&e)>>>2|(858993459&e)<<2,e=(4042322160&e)>>>4|(252645135&e)<<4,e=(4278255360&e)>>>8|(16711935&e)<<8,t.r[r]=(e>>>16|e<<16)>>>17}function n(e,t,r){for(;0!=t--;)e.push(0,r)}for(r=0;r<32;r++)t.q[r]=t.S[r]<<3|t.T[r],t.c[r]=t.p[r]<<4|t.z[r];n(t._,144,8),n(t._,112,9),n(t._,24,7),n(t._,8,8),e.H.n(t._,9),e.H.A(t._,9,t.J),e.H.l(t._,9),n(t.$,32,5),e.H.n(t.$,5),e.H.A(t.$,5,t.h),e.H.l(t.$,5),n(t.Q,19,0),n(t.C,286,0),n(t.D,30,0),n(t.v,320,0)}(),e.H.N}();function _getBPP(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth}function _filterZero(e,t,r,i,o){let a=_getBPP(t);const s=Math.ceil(i*a/8);let f,l;a=Math.ceil(a/8);let c=e[r],u=0;if(c>1&&(e[r]=[0,0,1][c-2]),3==c)for(u=a;u<s;u++)e[u+1]=e[u+1]+(e[u+1-a]>>>1)&255;for(let t=0;t<o;t++)if(f=r+t*s,l=f+t+1,c=e[l-1],u=0,0==c)for(;u<s;u++)e[f+u]=e[l+u];else if(1==c){for(;u<a;u++)e[f+u]=e[l+u];for(;u<s;u++)e[f+u]=e[l+u]+e[f+u-a]}else if(2==c)for(;u<s;u++)e[f+u]=e[l+u]+e[f+u-s];else if(3==c){for(;u<a;u++)e[f+u]=e[l+u]+(e[f+u-s]>>>1);for(;u<s;u++)e[f+u]=e[l+u]+(e[f+u-s]+e[f+u-a]>>>1)}else{for(;u<a;u++)e[f+u]=e[l+u]+_paeth(0,e[f+u-s],0);for(;u<s;u++)e[f+u]=e[l+u]+_paeth(e[f+u-a],e[f+u-s],e[f+u-a-s])}return e}function _paeth(e,t,r){const i=e+t-r,o=i-e,a=i-t,s=i-r;return o*o<=a*a&&o*o<=s*s?e:a*a<=s*s?t:r}function _IHDR(t,r,i){i.width=e.readUint(t,r),r+=4,i.height=e.readUint(t,r),r+=4,i.depth=t[r],r++,i.ctype=t[r],r++,i.compress=t[r],r++,i.filter=t[r],r++,i.interlace=t[r],r++}function _copyTile(e,t,r,i,o,a,s,f,l){const c=Math.min(t,o),u=Math.min(r,a);let d=0,h=0;for(let r=0;r<u;r++)for(let a=0;a<c;a++)if(s>=0&&f>=0?(d=r*t+a<<2,h=(f+r)*o+s+a<<2):(d=(-f+r)*t-s+a<<2,h=r*o+a<<2),0==l)i[h]=e[d],i[h+1]=e[d+1],i[h+2]=e[d+2],i[h+3]=e[d+3];else if(1==l){var g=e[d+3]*(1/255),p=e[d]*g,m=e[d+1]*g,w=e[d+2]*g,A=i[h+3]*(1/255),v=i[h]*A,b=i[h+1]*A,y=i[h+2]*A;const t=1-g,r=g+A*t,o=0==r?0:1/r;i[h+3]=255*r,i[h+0]=(p+v*t)*o,i[h+1]=(m+b*t)*o,i[h+2]=(w+y*t)*o}else if(2==l){g=e[d+3],p=e[d],m=e[d+1],w=e[d+2],A=i[h+3],v=i[h],b=i[h+1],y=i[h+2];g==A&&p==v&&m==b&&w==y?(i[h]=0,i[h+1]=0,i[h+2]=0,i[h+3]=0):(i[h]=p,i[h+1]=m,i[h+2]=w,i[h+3]=g)}else if(3==l){g=e[d+3],p=e[d],m=e[d+1],w=e[d+2],A=i[h+3],v=i[h],b=i[h+1],y=i[h+2];if(g==A&&p==v&&m==b&&w==y)continue;if(g<220&&A>20)return!1}return!0}return{decode:function decode(r){const i=new Uint8Array(r);let o=8;const a=e,s=a.readUshort,f=a.readUint,l={tabs:{},frames:[]},c=new Uint8Array(i.length);let u,d=0,h=0;const g=[137,80,78,71,13,10,26,10];for(var p=0;p<8;p++)if(i[p]!=g[p])throw"The input is not a PNG file!";for(;o<i.length;){const e=a.readUint(i,o);o+=4;const r=a.readASCII(i,o,4);if(o+=4,"IHDR"==r)_IHDR(i,o,l);else if("iCCP"==r){for(var m=o;0!=i[m];)m++;a.readASCII(i,o,m-o),i[m+1];const s=i.slice(m+2,o+e);let f=null;try{f=_inflate(s)}catch(e){f=t(s)}l.tabs[r]=f}else if("CgBI"==r)l.tabs[r]=i.slice(o,o+4);else if("IDAT"==r){for(p=0;p<e;p++)c[d+p]=i[o+p];d+=e}else if("acTL"==r)l.tabs[r]={num_frames:f(i,o),num_plays:f(i,o+4)},u=new Uint8Array(i.length);else if("fcTL"==r){if(0!=h)(F=l.frames[l.frames.length-1]).data=_decompress(l,u.slice(0,h),F.rect.width,F.rect.height),h=0;const e={x:f(i,o+12),y:f(i,o+16),width:f(i,o+4),height:f(i,o+8)};let t=s(i,o+22);t=s(i,o+20)/(0==t?100:t);const r={rect:e,delay:Math.round(1e3*t),dispose:i[o+24],blend:i[o+25]};l.frames.push(r)}else if("fdAT"==r){for(p=0;p<e-4;p++)u[h+p]=i[o+p+4];h+=e-4}else if("pHYs"==r)l.tabs[r]=[a.readUint(i,o),a.readUint(i,o+4),i[o+8]];else if("cHRM"==r){l.tabs[r]=[];for(p=0;p<8;p++)l.tabs[r].push(a.readUint(i,o+4*p))}else if("tEXt"==r||"zTXt"==r){null==l.tabs[r]&&(l.tabs[r]={});var w=a.nextZero(i,o),A=a.readASCII(i,o,w-o),v=o+e-w-1;if("tEXt"==r)y=a.readASCII(i,w+1,v);else{var b=_inflate(i.slice(w+2,w+2+v));y=a.readUTF8(b,0,b.length)}l.tabs[r][A]=y}else if("iTXt"==r){null==l.tabs[r]&&(l.tabs[r]={});w=0,m=o;w=a.nextZero(i,m);A=a.readASCII(i,m,w-m);const t=i[m=w+1];var y;i[m+1],m+=2,w=a.nextZero(i,m),a.readASCII(i,m,w-m),m=w+1,w=a.nextZero(i,m),a.readUTF8(i,m,w-m);v=e-((m=w+1)-o);if(0==t)y=a.readUTF8(i,m,v);else{b=_inflate(i.slice(m,m+v));y=a.readUTF8(b,0,b.length)}l.tabs[r][A]=y}else if("PLTE"==r)l.tabs[r]=a.readBytes(i,o,e);else if("hIST"==r){const e=l.tabs.PLTE.length/3;l.tabs[r]=[];for(p=0;p<e;p++)l.tabs[r].push(s(i,o+2*p))}else if("tRNS"==r)3==l.ctype?l.tabs[r]=a.readBytes(i,o,e):0==l.ctype?l.tabs[r]=s(i,o):2==l.ctype&&(l.tabs[r]=[s(i,o),s(i,o+2),s(i,o+4)]);else if("gAMA"==r)l.tabs[r]=a.readUint(i,o)/1e5;else if("sRGB"==r)l.tabs[r]=i[o];else if("bKGD"==r)0==l.ctype||4==l.ctype?l.tabs[r]=[s(i,o)]:2==l.ctype||6==l.ctype?l.tabs[r]=[s(i,o),s(i,o+2),s(i,o+4)]:3==l.ctype&&(l.tabs[r]=i[o]);else if("IEND"==r)break;o+=e,a.readUint(i,o),o+=4}var F;return 0!=h&&((F=l.frames[l.frames.length-1]).data=_decompress(l,u.slice(0,h),F.rect.width,F.rect.height)),l.data=_decompress(l,c,l.width,l.height),delete l.compress,delete l.interlace,delete l.filter,l},toRGBA8:function toRGBA8(e){const t=e.width,r=e.height;if(null==e.tabs.acTL)return[decodeImage(e.data,t,r,e).buffer];const i=[];null==e.frames[0].data&&(e.frames[0].data=e.data);const o=t*r*4,a=new Uint8Array(o),s=new Uint8Array(o),f=new Uint8Array(o);for(let c=0;c<e.frames.length;c++){const u=e.frames[c],d=u.rect.x,h=u.rect.y,g=u.rect.width,p=u.rect.height,m=decodeImage(u.data,g,p,e);if(0!=c)for(var l=0;l<o;l++)f[l]=a[l];if(0==u.blend?_copyTile(m,g,p,a,t,r,d,h,0):1==u.blend&&_copyTile(m,g,p,a,t,r,d,h,1),i.push(a.buffer.slice(0)),0==u.dispose);else if(1==u.dispose)_copyTile(s,g,p,a,t,r,d,h,0);else if(2==u.dispose)for(l=0;l<o;l++)a[l]=f[l]}return i},_paeth:_paeth,_copyTile:_copyTile,_bin:e}}();!function(){const{_copyTile:e}=UPNG,{_bin:t}=UPNG,r=UPNG._paeth;var o={table:function(){const e=new Uint32Array(256);for(let t=0;t<256;t++){let r=t;for(let e=0;e<8;e++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update(e,t,r,i){for(let a=0;a<i;a++)e=o.table[255&(e^t[r+a])]^e>>>8;return e},crc:(e,t,r)=>4294967295^o.update(4294967295,e,t,r)};function addErr(e,t,r,i){t[r]+=e[0]*i>>4,t[r+1]+=e[1]*i>>4,t[r+2]+=e[2]*i>>4,t[r+3]+=e[3]*i>>4}function N(e){return Math.max(0,Math.min(255,e))}function D(e,t){const r=e[0]-t[0],i=e[1]-t[1],o=e[2]-t[2],a=e[3]-t[3];return r*r+i*i+o*o+a*a}function dither(e,t,r,i,o,a,s){null==s&&(s=1);const f=i.length,l=[];for(var c=0;c<f;c++){const e=i[c];l.push([e>>>0&255,e>>>8&255,e>>>16&255,e>>>24&255])}for(c=0;c<f;c++){let e=4294967295;for(var u=0,d=0;d<f;d++){var h=D(l[c],l[d]);d!=c&&h<e&&(e=h,u=d)}}const g=new Uint32Array(o.buffer),p=new Int16Array(t*r*4),m=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(c=0;c<m.length;c++)m[c]=255*((m[c]+.5)/16-.5);for(let o=0;o<r;o++)for(let A=0;A<t;A++){var w;c=4*(o*t+A);if(2!=s)w=[N(e[c]+p[c]),N(e[c+1]+p[c+1]),N(e[c+2]+p[c+2]),N(e[c+3]+p[c+3])];else{h=m[4*(3&o)+(3&A)];w=[N(e[c]+h),N(e[c+1]+h),N(e[c+2]+h),N(e[c+3]+h)]}u=0;let v=16777215;for(d=0;d<f;d++){const e=D(w,l[d]);e<v&&(v=e,u=d)}const b=l[u],y=[w[0]-b[0],w[1]-b[1],w[2]-b[2],w[3]-b[3]];1==s&&(A!=t-1&&addErr(y,p,c+4,7),o!=r-1&&(0!=A&&addErr(y,p,c+4*t-4,3),addErr(y,p,c+4*t,5),A!=t-1&&addErr(y,p,c+4*t+4,1))),a[c>>2]=u,g[c>>2]=i[u]}}function _main(e,r,i,a,s){null==s&&(s={});const{crc:f}=o,l=t.writeUint,c=t.writeUshort,u=t.writeASCII;let d=8;const h=e.frames.length>1;let g,p=!1,m=33+(h?20:0);if(null!=s.sRGB&&(m+=13),null!=s.pHYs&&(m+=21),null!=s.iCCP&&(g=pako.deflate(s.iCCP),m+=21+g.length+4),3==e.ctype){for(var w=e.plte.length,A=0;A<w;A++)e.plte[A]>>>24!=255&&(p=!0);m+=8+3*w+4+(p?8+1*w+4:0)}for(var v=0;v<e.frames.length;v++){h&&(m+=38),m+=(U=e.frames[v]).cimg.length+12,0!=v&&(m+=4)}m+=12;const b=new Uint8Array(m),y=[137,80,78,71,13,10,26,10];for(A=0;A<8;A++)b[A]=y[A];if(l(b,d,13),d+=4,u(b,d,"IHDR"),d+=4,l(b,d,r),d+=4,l(b,d,i),d+=4,b[d]=e.depth,d++,b[d]=e.ctype,d++,b[d]=0,d++,b[d]=0,d++,b[d]=0,d++,l(b,d,f(b,d-17,17)),d+=4,null!=s.sRGB&&(l(b,d,1),d+=4,u(b,d,"sRGB"),d+=4,b[d]=s.sRGB,d++,l(b,d,f(b,d-5,5)),d+=4),null!=s.iCCP){const e=13+g.length;l(b,d,e),d+=4,u(b,d,"iCCP"),d+=4,u(b,d,"ICC profile"),d+=11,d+=2,b.set(g,d),d+=g.length,l(b,d,f(b,d-(e+4),e+4)),d+=4}if(null!=s.pHYs&&(l(b,d,9),d+=4,u(b,d,"pHYs"),d+=4,l(b,d,s.pHYs[0]),d+=4,l(b,d,s.pHYs[1]),d+=4,b[d]=s.pHYs[2],d++,l(b,d,f(b,d-13,13)),d+=4),h&&(l(b,d,8),d+=4,u(b,d,"acTL"),d+=4,l(b,d,e.frames.length),d+=4,l(b,d,null!=s.loop?s.loop:0),d+=4,l(b,d,f(b,d-12,12)),d+=4),3==e.ctype){l(b,d,3*(w=e.plte.length)),d+=4,u(b,d,"PLTE"),d+=4;for(A=0;A<w;A++){const t=3*A,r=e.plte[A],i=255&r,o=r>>>8&255,a=r>>>16&255;b[d+t+0]=i,b[d+t+1]=o,b[d+t+2]=a}if(d+=3*w,l(b,d,f(b,d-3*w-4,3*w+4)),d+=4,p){l(b,d,w),d+=4,u(b,d,"tRNS"),d+=4;for(A=0;A<w;A++)b[d+A]=e.plte[A]>>>24&255;d+=w,l(b,d,f(b,d-w-4,w+4)),d+=4}}let F=0;for(v=0;v<e.frames.length;v++){var U=e.frames[v];h&&(l(b,d,26),d+=4,u(b,d,"fcTL"),d+=4,l(b,d,F++),d+=4,l(b,d,U.rect.width),d+=4,l(b,d,U.rect.height),d+=4,l(b,d,U.rect.x),d+=4,l(b,d,U.rect.y),d+=4,c(b,d,a[v]),d+=2,c(b,d,1e3),d+=2,b[d]=U.dispose,d++,b[d]=U.blend,d++,l(b,d,f(b,d-30,30)),d+=4);const t=U.cimg;l(b,d,(w=t.length)+(0==v?0:4)),d+=4;const r=d;u(b,d,0==v?"IDAT":"fdAT"),d+=4,0!=v&&(l(b,d,F++),d+=4),b.set(t,d),d+=w,l(b,d,f(b,r,d-r)),d+=4}return l(b,d,0),d+=4,u(b,d,"IEND"),d+=4,l(b,d,f(b,d-4,4)),d+=4,b.buffer}function compressPNG(e,t,r){for(let i=0;i<e.frames.length;i++){const o=e.frames[i];o.rect.width;const a=o.rect.height,s=new Uint8Array(a*o.bpl+a);o.cimg=_filterZero(o.img,a,o.bpp,o.bpl,s,t,r)}}function compress(t,r,i,o,a){const s=a[0],f=a[1],l=a[2],c=a[3],u=a[4],d=a[5];let h=6,g=8,p=255;for(var m=0;m<t.length;m++){const e=new Uint8Array(t[m]);for(var w=e.length,A=0;A<w;A+=4)p&=e[A+3]}const v=255!=p,b=function framize(t,r,i,o,a,s){const f=[];for(var l=0;l<t.length;l++){const d=new Uint8Array(t[l]),g=new Uint32Array(d.buffer);var c;let p=0,m=0,w=r,A=i,v=o?1:0;if(0!=l){const b=s||o||1==l||0!=f[l-2].dispose?1:2;let y=0,F=1e9;for(let e=0;e<b;e++){var u=new Uint8Array(t[l-1-e]);const o=new Uint32Array(t[l-1-e]);let s=r,f=i,c=-1,d=-1;for(let e=0;e<i;e++)for(let t=0;t<r;t++){g[h=e*r+t]!=o[h]&&(t<s&&(s=t),t>c&&(c=t),e<f&&(f=e),e>d&&(d=e))}-1==c&&(s=f=c=d=0),a&&(1&~s||s--,1&~f||f--);const v=(c-s+1)*(d-f+1);v<F&&(F=v,y=e,p=s,m=f,w=c-s+1,A=d-f+1)}u=new Uint8Array(t[l-1-y]);1==y&&(f[l-1].dispose=2),c=new Uint8Array(w*A*4),e(u,r,i,c,w,A,-p,-m,0),v=e(d,r,i,c,w,A,-p,-m,3)?1:0,1==v?_prepareDiff(d,r,i,c,{x:p,y:m,width:w,height:A}):e(d,r,i,c,w,A,-p,-m,0)}else c=d.slice(0);f.push({rect:{x:p,y:m,width:w,height:A},img:c,blend:v,dispose:0})}if(o)for(l=0;l<f.length;l++){if(1==(g=f[l]).blend)continue;const e=g.rect,o=f[l-1].rect,s=Math.min(e.x,o.x),c=Math.min(e.y,o.y),u={x:s,y:c,width:Math.max(e.x+e.width,o.x+o.width)-s,height:Math.max(e.y+e.height,o.y+o.height)-c};f[l-1].dispose=1,l-1!=0&&_updateFrame(t,r,i,f,l-1,u,a),_updateFrame(t,r,i,f,l,u,a)}let d=0;if(1!=t.length)for(var h=0;h<f.length;h++){var g;d+=(g=f[h]).rect.width*g.rect.height}return f}(t,r,i,s,f,l),y={},F=[],U=[];if(0!=o){const e=[];for(A=0;A<b.length;A++)e.push(b[A].img.buffer);const t=function concatRGBA(e){let t=0;for(var r=0;r<e.length;r++)t+=e[r].byteLength;const i=new Uint8Array(t);let o=0;for(r=0;r<e.length;r++){const t=new Uint8Array(e[r]),a=t.length;for(let e=0;e<a;e+=4){let r=t[e],a=t[e+1],s=t[e+2];const f=t[e+3];0==f&&(r=a=s=0),i[o+e]=r,i[o+e+1]=a,i[o+e+2]=s,i[o+e+3]=f}o+=a}return i.buffer}(e),r=quantize(t,o);for(A=0;A<r.plte.length;A++)F.push(r.plte[A].est.rgba);let i=0;for(A=0;A<b.length;A++){const e=(C=b[A]).img.length;var _=new Uint8Array(r.inds.buffer,i>>2,e>>2);U.push(_);const t=new Uint8Array(r.abuf,i,e);d&&dither(C.img,C.rect.width,C.rect.height,F,t,_),C.img.set(t),i+=e}}else for(m=0;m<b.length;m++){var C=b[m];const e=new Uint32Array(C.img.buffer);var E=C.rect.width;w=e.length,_=new Uint8Array(w);U.push(_);for(A=0;A<w;A++){const t=e[A];if(0!=A&&t==e[A-1])_[A]=_[A-1];else if(A>E&&t==e[A-E])_[A]=_[A-E];else{let e=y[t];if(null==e&&(y[t]=e=F.length,F.push(t),F.length>=300))break;_[A]=e}}}const I=F.length;I<=256&&0==u&&(g=I<=2?1:I<=4?2:I<=16?4:8,g=Math.max(g,c));for(m=0;m<b.length;m++){(C=b[m]).rect.x,C.rect.y;E=C.rect.width;const e=C.rect.height;let t=C.img;new Uint32Array(t.buffer);let r=4*E,i=4;if(I<=256&&0==u){r=Math.ceil(g*E/8);var B=new Uint8Array(r*e);const o=U[m];for(let t=0;t<e;t++){A=t*r;const e=t*E;if(8==g)for(var M=0;M<E;M++)B[A+M]=o[e+M];else if(4==g)for(M=0;M<E;M++)B[A+(M>>1)]|=o[e+M]<<4-4*(1&M);else if(2==g)for(M=0;M<E;M++)B[A+(M>>2)]|=o[e+M]<<6-2*(3&M);else if(1==g)for(M=0;M<E;M++)B[A+(M>>3)]|=o[e+M]<<7-1*(7&M)}t=B,h=3,i=1}else if(0==v&&1==b.length){B=new Uint8Array(E*e*3);const o=E*e;for(A=0;A<o;A++){const e=3*A,r=4*A;B[e]=t[r],B[e+1]=t[r+1],B[e+2]=t[r+2]}t=B,h=2,i=3,r=3*E}C.img=t,C.bpl=r,C.bpp=i}return{ctype:h,depth:g,plte:F,frames:b}}function _updateFrame(t,r,i,o,a,s,f){const l=Uint8Array,c=Uint32Array,u=new l(t[a-1]),d=new c(t[a-1]),h=a+1<t.length?new l(t[a+1]):null,g=new l(t[a]),p=new c(g.buffer);let m=r,w=i,A=-1,v=-1;for(let e=0;e<s.height;e++)for(let t=0;t<s.width;t++){const i=s.x+t,f=s.y+e,l=f*r+i,c=p[l];0==c||0==o[a-1].dispose&&d[l]==c&&(null==h||0!=h[4*l+3])||(i<m&&(m=i),i>A&&(A=i),f<w&&(w=f),f>v&&(v=f))}-1==A&&(m=w=A=v=0),f&&(1&~m||m--,1&~w||w--),s={x:m,y:w,width:A-m+1,height:v-w+1};const b=o[a];b.rect=s,b.blend=1,b.img=new Uint8Array(s.width*s.height*4),0==o[a-1].dispose?(e(u,r,i,b.img,s.width,s.height,-s.x,-s.y,0),_prepareDiff(g,r,i,b.img,s)):e(g,r,i,b.img,s.width,s.height,-s.x,-s.y,0)}function _prepareDiff(t,r,i,o,a){e(t,r,i,o,a.width,a.height,-a.x,-a.y,2)}function _filterZero(e,t,r,o,a,s,f){const l=[];let c,u=[0,1,2,3,4];-1!=s?u=[s]:(t*o>5e5||1==r)&&(u=[0]),f&&(c={level:0});const d=i;for(var h=0;h<u.length;h++){for(let i=0;i<t;i++)_filterLine(a,e,i,o,r,u[h]);l.push(d.deflate(a,c))}let g,p=1e9;for(h=0;h<l.length;h++)l[h].length<p&&(g=h,p=l[h].length);return l[g]}function _filterLine(e,t,i,o,a,s){const f=i*o;let l=f+i;if(e[l]=s,l++,0==s)if(o<500)for(var c=0;c<o;c++)e[l+c]=t[f+c];else e.set(new Uint8Array(t.buffer,f,o),l);else if(1==s){for(c=0;c<a;c++)e[l+c]=t[f+c];for(c=a;c<o;c++)e[l+c]=t[f+c]-t[f+c-a]+256&255}else if(0==i){for(c=0;c<a;c++)e[l+c]=t[f+c];if(2==s)for(c=a;c<o;c++)e[l+c]=t[f+c];if(3==s)for(c=a;c<o;c++)e[l+c]=t[f+c]-(t[f+c-a]>>1)+256&255;if(4==s)for(c=a;c<o;c++)e[l+c]=t[f+c]-r(t[f+c-a],0,0)+256&255}else{if(2==s)for(c=0;c<o;c++)e[l+c]=t[f+c]+256-t[f+c-o]&255;if(3==s){for(c=0;c<a;c++)e[l+c]=t[f+c]+256-(t[f+c-o]>>1)&255;for(c=a;c<o;c++)e[l+c]=t[f+c]+256-(t[f+c-o]+t[f+c-a]>>1)&255}if(4==s){for(c=0;c<a;c++)e[l+c]=t[f+c]+256-r(0,t[f+c-o],0)&255;for(c=a;c<o;c++)e[l+c]=t[f+c]+256-r(t[f+c-a],t[f+c-o],t[f+c-a-o])&255}}}function quantize(e,t){const r=new Uint8Array(e),i=r.slice(0),o=new Uint32Array(i.buffer),a=getKDtree(i,t),s=a[0],f=a[1],l=r.length,c=new Uint8Array(l>>2);let u;if(r.length<2e7)for(var d=0;d<l;d+=4){u=getNearest(s,h=r[d]*(1/255),g=r[d+1]*(1/255),p=r[d+2]*(1/255),m=r[d+3]*(1/255)),c[d>>2]=u.ind,o[d>>2]=u.est.rgba}else for(d=0;d<l;d+=4){var h=r[d]*(1/255),g=r[d+1]*(1/255),p=r[d+2]*(1/255),m=r[d+3]*(1/255);for(u=s;u.left;)u=planeDst(u.est,h,g,p,m)<=0?u.left:u.right;c[d>>2]=u.ind,o[d>>2]=u.est.rgba}return{abuf:i.buffer,inds:c,plte:f}}function getKDtree(e,t,r){null==r&&(r=1e-4);const i=new Uint32Array(e.buffer),o={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};o.bst=stats(e,o.i0,o.i1),o.est=estats(o.bst);const a=[o];for(;a.length<t;){let t=0,o=0;for(var s=0;s<a.length;s++)a[s].est.L>t&&(t=a[s].est.L,o=s);if(t<r)break;const f=a[o],l=splitPixels(e,i,f.i0,f.i1,f.est.e,f.est.eMq255);if(f.i0>=l||f.i1<=l){f.est.L=0;continue}const c={i0:f.i0,i1:l,bst:null,est:null,tdst:0,left:null,right:null};c.bst=stats(e,c.i0,c.i1),c.est=estats(c.bst);const u={i0:l,i1:f.i1,bst:null,est:null,tdst:0,left:null,right:null};u.bst={R:[],m:[],N:f.bst.N-c.bst.N};for(s=0;s<16;s++)u.bst.R[s]=f.bst.R[s]-c.bst.R[s];for(s=0;s<4;s++)u.bst.m[s]=f.bst.m[s]-c.bst.m[s];u.est=estats(u.bst),f.left=c,f.right=u,a[o]=c,a.push(u)}a.sort(((e,t)=>t.bst.N-e.bst.N));for(s=0;s<a.length;s++)a[s].ind=s;return[o,a]}function getNearest(e,t,r,i,o){if(null==e.left)return e.tdst=function dist(e,t,r,i,o){const a=t-e[0],s=r-e[1],f=i-e[2],l=o-e[3];return a*a+s*s+f*f+l*l}(e.est.q,t,r,i,o),e;const a=planeDst(e.est,t,r,i,o);let s=e.left,f=e.right;a>0&&(s=e.right,f=e.left);const l=getNearest(s,t,r,i,o);if(l.tdst<=a*a)return l;const c=getNearest(f,t,r,i,o);return c.tdst<l.tdst?c:l}function planeDst(e,t,r,i,o){const{e:a}=e;return a[0]*t+a[1]*r+a[2]*i+a[3]*o-e.eMq}function splitPixels(e,t,r,i,o,a){for(i-=4;r<i;){for(;vecDot(e,r,o)<=a;)r+=4;for(;vecDot(e,i,o)>a;)i-=4;if(r>=i)break;const s=t[r>>2];t[r>>2]=t[i>>2],t[i>>2]=s,r+=4,i-=4}for(;vecDot(e,r,o)>a;)r-=4;return r+4}function vecDot(e,t,r){return e[t]*r[0]+e[t+1]*r[1]+e[t+2]*r[2]+e[t+3]*r[3]}function stats(e,t,r){const i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=[0,0,0,0],a=r-t>>2;for(let a=t;a<r;a+=4){const t=e[a]*(1/255),r=e[a+1]*(1/255),s=e[a+2]*(1/255),f=e[a+3]*(1/255);o[0]+=t,o[1]+=r,o[2]+=s,o[3]+=f,i[0]+=t*t,i[1]+=t*r,i[2]+=t*s,i[3]+=t*f,i[5]+=r*r,i[6]+=r*s,i[7]+=r*f,i[10]+=s*s,i[11]+=s*f,i[15]+=f*f}return i[4]=i[1],i[8]=i[2],i[9]=i[6],i[12]=i[3],i[13]=i[7],i[14]=i[11],{R:i,m:o,N:a}}function estats(e){const{R:t}=e,{m:r}=e,{N:i}=e,o=r[0],s=r[1],f=r[2],l=r[3],c=0==i?0:1/i,u=[t[0]-o*o*c,t[1]-o*s*c,t[2]-o*f*c,t[3]-o*l*c,t[4]-s*o*c,t[5]-s*s*c,t[6]-s*f*c,t[7]-s*l*c,t[8]-f*o*c,t[9]-f*s*c,t[10]-f*f*c,t[11]-f*l*c,t[12]-l*o*c,t[13]-l*s*c,t[14]-l*f*c,t[15]-l*l*c],d=u,h=a;let g=[Math.random(),Math.random(),Math.random(),Math.random()],p=0,m=0;if(0!=i)for(let e=0;e<16&&(g=h.multVec(d,g),m=Math.sqrt(h.dot(g,g)),g=h.sml(1/m,g),!(0!=e&&Math.abs(m-p)<1e-9));e++)p=m;const w=[o*c,s*c,f*c,l*c];return{Cov:u,q:w,e:g,L:p,eMq255:h.dot(h.sml(255,w),g),eMq:h.dot(g,w),rgba:(Math.round(255*w[3])<<24|Math.round(255*w[2])<<16|Math.round(255*w[1])<<8|Math.round(255*w[0]))>>>0}}var a={multVec:(e,t)=>[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],sml:(e,t)=>[e*t[0],e*t[1],e*t[2],e*t[3]]};UPNG.encode=function encode(e,t,r,i,o,a,s){null==i&&(i=0),null==s&&(s=!1);const f=compress(e,t,r,i,[!1,!1,!1,0,s,!1]);return compressPNG(f,-1),_main(f,t,r,o,a)},UPNG.encodeLL=function encodeLL(e,t,r,i,o,a,s,f){const l={ctype:0+(1==i?0:2)+(0==o?0:4),depth:a,frames:[]},c=(i+o)*a,u=c*t;for(let i=0;i<e.length;i++)l.frames.push({rect:{x:0,y:0,width:t,height:r},img:new Uint8Array(e[i]),blend:0,dispose:1,bpp:Math.ceil(c/8),bpl:Math.ceil(u/8)});return compressPNG(l,0,!0),_main(l,t,r,s,f)},UPNG.encode.compress=compress,UPNG.encode.dither=dither,UPNG.quantize=quantize,UPNG.quantize.getKDtree=getKDtree,UPNG.quantize.getNearest=getNearest}();const o={toArrayBuffer(e,t){const r=e.width,i=e.height,a=r<<2,s=e.getContext("2d").getImageData(0,0,r,i),f=new Uint32Array(s.data.buffer),l=(32*r+31)/32<<2,c=l*i,u=122+c,d=new ArrayBuffer(u),h=new DataView(d),g=1<<20;let p,m,w,A,v=g,b=0,y=0,F=0;function set16(e){h.setUint16(y,e,!0),y+=2}function set32(e){h.setUint32(y,e,!0),y+=4}function seek(e){y+=e}set16(19778),set32(u),seek(4),set32(122),set32(108),set32(r),set32(-i>>>0),set16(1),set16(32),set32(3),set32(c),set32(2835),set32(2835),seek(8),set32(16711680),set32(65280),set32(255),set32(4278190080),set32(1466527264),function convert(){for(;b<i&&v>0;){for(A=122+b*l,p=0;p<a;)v--,m=f[F++],w=m>>>24,h.setUint32(A+p,m<<8|w),p+=4;b++}F<f.length?(v=g,setTimeout(convert,o._dly)):t(d)}()},toBlob(e,t){this.toArrayBuffer(e,(e=>{t(new Blob([e],{type:"image/bmp"}))}))},_dly:9};var a={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},s={[a.CHROME]:16384,[a.FIREFOX]:11180,[a.DESKTOP_SAFARI]:16384,[a.IE]:8192,[a.IOS]:4096,[a.ETC]:8192};const f="undefined"!=typeof window,l="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,c=f&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),CustomFile=(f||l)&&(c&&c.getOriginalSymbol(window,"File")||"undefined"!=typeof File&&File),CustomFileReader=(f||l)&&(c&&c.getOriginalSymbol(window,"FileReader")||"undefined"!=typeof FileReader&&FileReader);function getFilefromDataUrl(e,t,r=Date.now()){return new Promise((i=>{const o=e.split(","),a=o[0].match(/:(.*?);/)[1],s=globalThis.atob(o[1]);let f=s.length;const l=new Uint8Array(f);for(;f--;)l[f]=s.charCodeAt(f);const c=new Blob([l],{type:a});c.name=t,c.lastModified=r,i(c)}))}function getDataUrlFromFile(e){return new Promise(((t,r)=>{const i=new CustomFileReader;i.onload=()=>t(i.result),i.onerror=e=>r(e),i.readAsDataURL(e)}))}function loadImage(e){return new Promise(((t,r)=>{const i=new Image;i.onload=()=>t(i),i.onerror=e=>r(e),i.src=e}))}function getBrowserName(){if(void 0!==getBrowserName.cachedResult)return getBrowserName.cachedResult;let e=a.ETC;const{userAgent:t}=navigator;return/Chrom(e|ium)/i.test(t)?e=a.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)?e=a.IOS:/Safari/i.test(t)?e=a.DESKTOP_SAFARI:/Firefox/i.test(t)?e=a.FIREFOX:(/MSIE/i.test(t)||!0==!!document.documentMode)&&(e=a.IE),getBrowserName.cachedResult=e,getBrowserName.cachedResult}function approximateBelowMaximumCanvasSizeOfBrowser(e,t){const r=getBrowserName(),i=s[r];let o=e,a=t,f=o*a;const l=o>a?a/o:o/a;for(;f>i*i;){const e=(i+o)/2,t=(i+a)/2;e<t?(a=t,o=t*l):(a=e*l,o=e),f=o*a}return{width:o,height:a}}function getNewCanvasAndCtx(e,t){let r,i;try{if(r=new OffscreenCanvas(e,t),i=r.getContext("2d"),null===i)throw new Error("getContext of OffscreenCanvas returns null")}catch(e){r=document.createElement("canvas"),i=r.getContext("2d")}return r.width=e,r.height=t,[r,i]}function drawImageInCanvas(e,t=void 0){const{width:r,height:i}=approximateBelowMaximumCanvasSizeOfBrowser(e.width,e.height),[o,a]=getNewCanvasAndCtx(r,i);return t&&/jpe?g/.test(t)&&(a.fillStyle="white",a.fillRect(0,0,o.width,o.height)),a.drawImage(e,0,0,o.width,o.height),o}function isIOS(){return void 0!==isIOS.cachedResult||(isIOS.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"undefined"!=typeof document&&"ontouchend"in document),isIOS.cachedResult}async function drawFileInCanvas(e,t={}){let r;try{if(isIOS()||[a.DESKTOP_SAFARI,a.MOBILE_SAFARI].includes(getBrowserName()))throw new Error("Skip createImageBitmap on IOS and Safari");r=await createImageBitmap(e)}catch(t){try{const t=await getDataUrlFromFile(e);r=await loadImage(t)}catch(e){throw e}}return[r,drawImageInCanvas(r,t.fileType||e.type)]}async function canvasToFile(e,t,r,i,a=1){let s;if("image/png"===t){const o=e.getContext("2d"),{data:f}=o.getImageData(0,0,e.width,e.height),l=UPNG.encode([f.buffer],e.width,e.height,4096*a);s=new Blob([l],{type:t}),s.name=r,s.lastModified=i}else if("image/bmp"===t)s=await new Promise((t=>o.toBlob(e,t))),s.name=r,s.lastModified=i;else if("function"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)s=await e.convertToBlob({type:t,quality:a}),s.name=r,s.lastModified=i;else{const o=e.toDataURL(t,a);s=await getFilefromDataUrl(o,r,i)}return s}function cleanupCanvasMemory(e){e.width=0,e.height=0}async function isAutoOrientationInBrowser(){if(void 0!==isAutoOrientationInBrowser.cachedResult)return isAutoOrientationInBrowser.cachedResult;const e=await getFilefromDataUrl("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()),t=(await drawFileInCanvas(e))[1],r=await canvasToFile(t,e.type,e.name,e.lastModified);cleanupCanvasMemory(t);const i=(await drawFileInCanvas(r))[0];return isAutoOrientationInBrowser.cachedResult=1===i.width&&2===i.height,isAutoOrientationInBrowser.cachedResult}function getExifOrientation(e){return new Promise(((t,r)=>{const i=new CustomFileReader;i.onload=e=>{const r=new DataView(e.target.result);if(65496!=r.getUint16(0,!1))return t(-2);const i=r.byteLength;let o=2;for(;o<i;){if(r.getUint16(o+2,!1)<=8)return t(-1);const e=r.getUint16(o,!1);if(o+=2,65505==e){if(1165519206!=r.getUint32(o+=2,!1))return t(-1);const e=18761==r.getUint16(o+=6,!1);o+=r.getUint32(o+4,e);const i=r.getUint16(o,e);o+=2;for(let a=0;a<i;a++)if(274==r.getUint16(o+12*a,e))return t(r.getUint16(o+12*a+8,e))}else{if(65280&~e)break;o+=r.getUint16(o,!1)}}return t(-1)},i.onerror=e=>r(e),i.readAsArrayBuffer(e)}))}function handleMaxWidthOrHeight(e,t){const{width:r}=e,{height:i}=e,{maxWidthOrHeight:o}=t;let a,s=e;return isFinite(o)&&(r>o||i>o)&&([s,a]=getNewCanvasAndCtx(r,i),r>i?(s.width=o,s.height=i/r*o):(s.width=r/i*o,s.height=o),a.drawImage(e,0,0,s.width,s.height),cleanupCanvasMemory(e)),s}function followExifOrientation(e,t){const{width:r}=e,{height:i}=e,[o,a]=getNewCanvasAndCtx(r,i);switch(t>4&&t<9?(o.width=i,o.height=r):(o.width=r,o.height=i),t){case 2:a.transform(-1,0,0,1,r,0);break;case 3:a.transform(-1,0,0,-1,r,i);break;case 4:a.transform(1,0,0,-1,0,i);break;case 5:a.transform(0,1,1,0,0,0);break;case 6:a.transform(0,1,-1,0,i,0);break;case 7:a.transform(0,-1,-1,0,i,r);break;case 8:a.transform(0,-1,1,0,0,r)}return a.drawImage(e,0,0,r,i),cleanupCanvasMemory(e),o}async function compress(e,t,r=0){let i=r;function incProgress(e=5){if(t.signal&&t.signal.aborted)throw t.signal.reason;i+=e,t.onProgress(Math.min(i,100))}function setProgress(e){if(t.signal&&t.signal.aborted)throw t.signal.reason;i=Math.min(Math.max(e,i),100),t.onProgress(i)}let o=t.maxIteration||10;const a=1024*t.maxSizeMB*1024;incProgress();const[,s]=await drawFileInCanvas(e,t);incProgress();const f=handleMaxWidthOrHeight(s,t);incProgress();const l=t.exifOrientation||await getExifOrientation(e);incProgress();const c=await isAutoOrientationInBrowser()?f:followExifOrientation(f,l);incProgress();let u=t.initialQuality||1;const d=t.fileType||e.type,h=await canvasToFile(c,d,e.name,e.lastModified,u);incProgress();const g=h.size>a,p=h.size>e.size;if(!g&&!p)return setProgress(100),h;const m=e.size,w=h.size;let A,v,b,y=w,F=c;const U=!t.alwaysKeepResolution&&g;for(;o--&&(y>a||y>m);){const t=U?.95*F.width:F.width,r=U?.95*F.height:F.height;[v,b]=getNewCanvasAndCtx(t,r),b.drawImage(F,0,0,t,r),u*="image/png"===d?.85:.95,A=await canvasToFile(v,d,e.name,e.lastModified,u),cleanupCanvasMemory(F),F=v,y=A.size,setProgress(Math.min(99,Math.floor((w-y)/(w-a)*100)))}return cleanupCanvasMemory(F),cleanupCanvasMemory(v),cleanupCanvasMemory(f),cleanupCanvasMemory(c),cleanupCanvasMemory(s),setProgress(100),A}let u;function compressOnWebWorker(e,t){return new Promise(((r,i)=>{u||(u=function createWorkerScriptURL(e){const t=[];return"function"==typeof e?t.push(`(${e})()`):t.push(e),URL.createObjectURL(new Blob(t))}("\nlet scriptImported = false\nself.addEventListener('message', async (e) => {\n  const { file, id, imageCompressionLibUrl, options } = e.data\n  options.onProgress = (progress) => self.postMessage({ progress, id })\n  try {\n    if (!scriptImported) {\n      // console.log('[worker] importScripts', imageCompressionLibUrl)\n      self.importScripts(imageCompressionLibUrl)\n      scriptImported = true\n    }\n    // console.log('[worker] self', self)\n    const compressedFile = await imageCompression(file, options)\n    self.postMessage({ file: compressedFile, id })\n  } catch (e) {\n    // console.error('[worker] error', e)\n    self.postMessage({ error: e.message + '\\n' + e.stack, id })\n  }\n})\n"));const o=new Worker(u);o.addEventListener("message",(function handler(e){if(t.signal&&t.signal.aborted)o.terminate();else if(void 0===e.data.progress){if(e.data.error)return i(new Error(e.data.error)),void o.terminate();r(e.data.file),o.terminate()}else t.onProgress(e.data.progress)})),o.addEventListener("error",i),t.signal&&t.signal.addEventListener("abort",(()=>{i(t.signal.reason),o.terminate()})),o.postMessage({file:e,imageCompressionLibUrl:t.libURL,options:{...t,onProgress:void 0,signal:void 0}})}))}async function imageCompression(e,t){const r={...t};let i,o=0;const{onProgress:a}=r;r.maxSizeMB=r.maxSizeMB||Number.POSITIVE_INFINITY;const s="boolean"!=typeof r.useWebWorker||r.useWebWorker;if(delete r.useWebWorker,r.onProgress=e=>{o=e,"function"==typeof a&&a(o)},!(e instanceof Blob||e instanceof CustomFile))throw new Error("The file given is not an instance of Blob or File");if(!/^image/.test(e.type))throw new Error("The file given is not an image");const f="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;if(s&&"function"==typeof Worker&&!f)try{if(!r?.libURL)throw new Error("libURL is required when using web worker");i=await compressOnWebWorker(e,r)}catch(t){i=await compress(e,r)}else i=await compress(e,r);try{i.name=e.name,i.lastModified=e.lastModified}catch(e){}try{r.preserveExif&&"image/jpeg"===e.type&&(!r.fileType||r.fileType&&r.fileType===e.type)&&(i=copyExifWithoutOrientation(e,i))}catch(e){}return i}imageCompression.getDataUrlFromFile=getDataUrlFromFile,imageCompression.getFilefromDataUrl=getFilefromDataUrl,imageCompression.loadImage=loadImage,imageCompression.drawImageInCanvas=drawImageInCanvas,imageCompression.drawFileInCanvas=drawFileInCanvas,imageCompression.canvasToFile=canvasToFile,imageCompression.getExifOrientation=getExifOrientation,imageCompression.handleMaxWidthOrHeight=handleMaxWidthOrHeight,imageCompression.followExifOrientation=followExifOrientation,imageCompression.cleanupCanvasMemory=cleanupCanvasMemory,imageCompression.isAutoOrientationInBrowser=isAutoOrientationInBrowser,imageCompression.approximateBelowMaximumCanvasSizeOfBrowser=approximateBelowMaximumCanvasSizeOfBrowser,imageCompression.copyExifWithoutOrientation=copyExifWithoutOrientation,imageCompression.getBrowserName=getBrowserName,imageCompression.version="2.0.2";export{imageCompression as default};
//# sourceMappingURL=browser-image-compression.mjs.map
